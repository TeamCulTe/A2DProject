sudo: required
jdk: oraclejdk8

language: php
php:
  - '7.0'
  
language: android
android:
  components:
  - tools
  - platform-tools
  - extra

  # The BuildTools version used by your project
  - build-tools-25.0.2

  # The SDK version used to compile your project
  - android-25

  # Additional components
  - extra-google-google_play_services
  - extra-google-m2repository
  - extra-android-m2repository
  - addon-google_apis-google-25

  # Specify at least one system image,
  # if you need to run emulator(s) during your tests
  - sys-img-armeabi-v7a-android-25

  licenses:
  - 'android-sdk-preview-license-52d11cd2'
  - 'android-sdk-license-.+'
  - 'google-gdk-license-.+'

# Getting mysql v 5.7
addons:
  apt:
    sources:
      - mysql-5.7-trusty
    packages:
      - mysql-server
      - mysql-client
      
# Installing all the required elements (php, mysql...)
before_install:
- sudo apt-get update
- sudo apt-get -y install apache2
- sudo mysql -u root -e "use mysql; update user set authentication_string=PASSWORD('root') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
- sudo mysql_upgrade -u root -proot
- sudo service mysql restart
- mysql -u root -proot -e 'CREATE DATABASE Readeo;'
- mysql -u root -proot Readeo < Middleware/docs/ReadeoMySQLDbStructure.sql
- sudo mv Middleware/* /var/www/html/

# Emulator Management: Create, Start and Wait
before_script:
- cd Readeo && chmod +x gradlew
- echo no | android create avd --force -n test -t android-25 --abi armeabi-v7a
- export ANDROID_SDK_ROOT=/usr/local/android-sdk
- emulator -avd test -no-accel -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &

# Actions to perform
script:
- ./gradlew build connectedCheck
- ./gradlew assembleDebug
- ./gradlew -Pci --console=plain :app:testDebug
- ./gradlew lint
- ./gradlew cAT
